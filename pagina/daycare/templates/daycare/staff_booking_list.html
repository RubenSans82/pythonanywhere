{# pagina/daycare/templates/daycare/staff_booking_list.html #}
{% extends 'daycare/base.html' %}
{% load static %}

{% block title %}Gestión de Reservas (Staff){% endblock %}

{% block content %}
    <h1 class="mb-4 text-primary">Gestión de Reservas <small class="text-muted">(Staff)</small></h1>

    <p class="lead">Listado completo de reservas.</p>

    {% if all_bookings %}
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Mascota</th>
                        <th>Dueño</th>
                        <th>Fecha</th>
                        <th>Hora</th>
                        <th>Estado</th>
                        <th>Solicitada El</th>
                        <th>Acciones</th> {# Columna para botones de acción #}
                    </tr>
                </thead>
                <tbody>
                    {% for reserva in all_bookings %}
                        <tr>
                            <td>{{ reserva.pk }}</td>
                            <td>
                                {# Enlace al detalle de la mascota #}
                                <a href="{% url 'daycare:detalle_mascota' reserva.pet.pk %}">{{ reserva.pet.nombre }}</a>
                                <small class="text-muted">({{ reserva.pet.raza|default:"N/A" }})</small>
                            </td>
                            <td>
                                {# Mostrar info del dueño #}
                                {{ reserva.pet.owner.user.username }}
                                <small class="text-muted">({{ reserva.pet.owner.user.first_name }} {{ reserva.pet.owner.user.last_name }})</small>
                            </td>
                            <td>{{ reserva.date|date:"d M Y" }}</td> {# Fecha formateada #}
                            <td>{{ reserva.time|time:"H:i" }}</td> {# Hora formateada #}
                            <td>
                                {# Mostrar el estado con la insignia de color #}
                                <span class="badge {% if reserva.status == 'Confirmed' %}bg-success{% elif reserva.status == 'Cancelled' %}bg-danger{% elif reserva.status == 'Completed' %}bg-secondary{% else %}bg-warning{% endif %}">
                                    {{ reserva.get_status_display }}
                                </span>
                            </td>
                             <td>{{ reserva.created_at|date:"d M Y H:i" }}</td> {# Fecha/hora de creación #}
                             <td>
                                {# --- Formulario para cambiar el estado --- #}
                                {# Este formulario envía un POST a la misma URL /staff/bookings/ #}
                                <form method="post" class="form-inline"> {# form-inline ayuda con la alineación en línea #}
                                    {% csrf_token %}
                                    {# Campo oculto para enviar el ID de la reserva que se va a modificar #}
                                    <input type="hidden" name="booking_id" value="{{ reserva.pk }}">
                                    {# Selector de estado generado por el formulario de la vista #}
                                    {{ form.new_status }}
                                    {# Botón de envío del formulario #}
                                    <button type="submit" class="btn btn-sm btn-primary mt-1 mt-sm-0">Cambiar</button> {# mt-1 y mt-sm-0 para ajuste de margen #}
                                </form>
                                {# --- Fin Formulario --- #}
                             </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p class="lead text-muted">No hay reservas registradas en el sistema.</p>
    {% endif %}

{% endblock content %}